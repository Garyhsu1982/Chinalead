<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Chinese Lead Isotope Database</title>
        <link rel="stylesheet" href="src/leaflet.css">
        <link rel="stylesheet" href="src/css/bootstrap-5/bootstrap.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="src/plugins/Leaflet.Pancontrol-master/L.Control.Pan.css">
        <link rel="stylesheet" href="src/plugins/Leaflet.zoomslider-master/L.Control.Zoomslider.css">
        <link rel="stylesheet" href="src/plugins/Leaflet.MousePosition-master/L.Control.MousePosition.css">
        <link rel="stylesheet" ref="src/plugins/Leaflet.PolylineMeasure-master/Leaflet.PolylineMeasure.css">
        <link rel="stylesheet" href="src/plugins/Leaflet.EasyButton-master/easy-button.css">
        <link rel="stylesheet" href="src/plugins/leaflet-sidebar-master/L.Control.Sidebar.css">
        <link rel="stylesheet" href="src/plugins/leaflet-styleeditor/dist/css/Leaflet.StyleEditor.min.css">
        <link rel="stylesheet" href="src/css/font-awesome.min.css">
        <link rel="stylesheet" href="src/plugins/leaflet.awesome-markers.css">
        <link rel="stylesheet" href="src/plugins/leaflet-mapkey/L.Icon.Mapkey.css">
        <link rel="stylesheet" href="src/plugins/MarkerCluster.Default.css">
        <link rel="stylesheet" href="src/jquery-ui.min.css">
        
        <script src="src/leaflet-src.js"></script>
        <script src="src/jquery-3.5.1.min.js"></script>
        <script src="src/js/bootstrap-5/bootstrap.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
        <script src="src/plugins/Leaflet.Pancontrol-master/L.Control.Pan.js"></script>
        <script src="src/plugins/Leaflet.zoomslider-master/L.Control.Zoomslider.js"></script>
        <script src="src/plugins/Leaflet.MousePosition-master/L.Control.MousePosition.js"></script>
        <script src="src/plugins/Leaflet.PolylineMeasure-master/Leaflet.PolylineMeasure.js"></script>
        <script src="src/plugins/Leaflet.EasyButton-master/easy-button.js"></script>
        <script src="src/plugins/leaflet-sidebar-master/L.Control.Sidebar.js"></script>
        <script src="src/plugins/leaflet-providers-master/leaflet-providers.js"></script>
        <script src="src/plugins/leaflet.awesome-markers.min.js"></script>
        <script src="src/plugins/leaflet-mapkey/L.Icon.Mapkey.js"></script>
        <script src="src/plugins/leaflet.markercluster.js"></script>
        <script src="src/jquery-ui.min.js"></script>
        
        <!--    ***************  Begin Leaflet.Draw-->         
        <script src="src/plugins/leaflet-draw/Leaflet.draw.js"></script> 
        <script src="src/plugins/leaflet-draw/Leaflet.Draw.Event.js"></script> 
        <link rel="stylesheet" href="src/plugins/leaflet-draw/leaflet.draw.css"/> 
        <script src="src/plugins/leaflet-draw/Toolbar.js"></script> 
        <script src="src/plugins/leaflet-draw/Tooltip.js"></script> 
        <script src="src/plugins/leaflet-draw/ext/GeometryUtil.js"></script> 
        <script src="src/plugins/leaflet-draw/ext/LatLngUtil.js"></script> 
        <script src="src/plugins/leaflet-draw/ext/LineUtil.Intersect.js"></script> 
        <script src="src/plugins/leaflet-draw/ext/Polygon.Intersect.js"></script> 
        <script src="src/plugins/leaflet-draw/ext/Polyline.Intersect.js"></script> 
        <script src="src/plugins/leaflet-draw/ext/TouchEvents.js"></script> 
        <script src="src/plugins/leaflet-draw/draw/DrawToolbar.js"></script> 
        <script src="src/plugins/leaflet-draw/draw/handler/Draw.Feature.js"></script> 
        <script src="src/plugins/leaflet-draw/draw/handler/Draw.SimpleShape.js"></script> 
        <script src="src/plugins/leaflet-draw/draw/handler/Draw.Polyline.js"></script> 
        <script src="src/plugins/leaflet-draw/draw/handler/Draw.Circle.js"></script> 
        <script src="src/plugins/leaflet-draw/draw/handler/Draw.Marker.js"></script> 
        <script src="src/plugins/leaflet-draw/draw/handler/Draw.Polygon.js"></script> 
        <script src="src/plugins/leaflet-draw/draw/handler/Draw.Rectangle.js"></script> 
        <script src="src/plugins/leaflet-draw/draw/handler/Draw.CircleMarker.js"></script> 
        <script src="src/plugins/leaflet-draw/edit/EditToolbar.js"></script> 
        <script src="src/plugins/leaflet-draw/edit/handler/EditToolbar.Edit.js"></script> 
        <script src="src/plugins/leaflet-draw/edit/handler/EditToolbar.Delete.js"></script> 
        <script src="src/plugins/leaflet-draw/Control.Draw.js"></script> 
        <script src="src/plugins/leaflet-draw/edit/handler/Edit.Poly.js"></script> 
        <script src="src/plugins/leaflet-draw/edit/handler/Edit.SimpleShape.js"></script> 
        <script src="src/plugins/leaflet-draw/edit/handler/Edit.CircleMarker.js"></script> 
        <script src="src/plugins/leaflet-draw/edit/handler/Edit.Circle.js"></script> 
        <script src="src/plugins/leaflet-draw/edit/handler/Edit.Rectangle.js"></script> 
        <script src="src/plugins/leaflet-draw/edit/handler/Edit.Marker.js"></script> 
        <!--    **************  End of Lealet Draw-->
        <script src="src/plugins/leaflet-styleeditor/dist/javascript/Leaflet.StyleEditor.min.js"></script>
        <script src="src/plugins/leaflet.ajax.min.js"></script>
        <script src="src/plugins/leaflet.sprite.js"></script>
        
        
        <!-- Setup basic layout with CSS and Bootstraps Html  -->
        <style> 
            #mapdiv {              
                height:100vh;
            }
            
            .col-xs-12, .col-xs-6, .col-xs-4 {   /*override bootstrap class so it wont take too much space*/
               padding:3px;
            }   
            
            #side-bar {
                background-color: lightgray;
            }
            
            #divProvince {
                background-color: #ffffb3;
            }
            
            #divEagle {
                background-color: #ccffb3;
            }
            
            #divRaptor {
                background-color: #e6ffff;
            }
            
            #divSpecimen {
                background-color: lightpink;
            }
            
            #divProject {
                background-color: beige;
            }
            
            .errorMsg {
                padding:0;
                text-align:center;
                background-color:darksalmon;
            }           
         
        </style>
    </head>
    <body>                         
         <div id="side-bar" class="col-md-3">
            <button id='btnLocate' class='btn btn-primary btn-block' onclick="window.open('https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/VID3WR')">Link to Data Source</button><br>
            
            <div id="divProject" class="col-xs-12">
                <div id="divProjectLabel" class="text-center col-xs-12">
                    <h4 id="lblProject">Site Name</h4>
                </div>
                <div id="divProjectError" class="errorMsg col-xs-12"></div>
                <div id="divFindProject" class="form-group has-error">
                    <div class="col-xs-6">
                        <input type="text" id="txtFindProject" class="form-control" placeholder="Site">
                    </div>
                    <div class="col-xs-6">
                        <button id="btnFindProject" class="btn btn-primary btn-block" >Find Site</button>
                    </div>
                </div>
                <div class="" id="divProjectData"></div>
            </div>
            <div id="divProvince" class="col-xs-12">
                <div id="divProvinceLabel" class="text-center col-xs-12">
                    <h4 id="lblProvince">Provinces of China</h4>
                </div>
                <div id="divProvinceError" class="errorMsg col-xs-12"></div>
                <div id="divFindProvince" class="form-group has-error">
                    <div class="col-xs-6">
                        <input type="text" id="txtFindProvince" class="form-control" placeholder="Province">
                    </div>
                    <div class="col-xs-6">
                        <button id="btnFindProvince" class="btn btn-primary btn-block">Find Province</button>
                    </div>
                </div>
                <div id="divFilterProvince" class="col-xs-12">
                    <div class="col-xs-4">
                        <input type='checkbox' name='fltProvince' value='Anhui' checked>Anhui<br>
                        <input type='checkbox' name='fltProvince' value='Guangdong' checked>Guangdong<br>
                        <input type='checkbox' name='fltProvince' value='Hebei' checked>Hebei<br>
                        <input type='checkbox' name='fltProvince' value='Hubei' checked>Hubei<br>
                        <input type='checkbox' name='fltProvince' value='Jiangsu' checked>Jiangsu<br>
                        <input type='checkbox' name='fltProvince' value='Liaoning' checked>Liaoning<br>
                        <input type='checkbox' name='fltProvince' value='Shandong' checked>Shandong<br>
                        <input type='checkbox' name='fltProvince' value='Sichuan' checked>Sichuan<br>
                        <input type='checkbox' name='fltProvince' value='Xinjiang' checked>Xinjiang
                        <button id="btnProvinceFilterAll" class="btn btn-primary btn-block">Check All</button>
                    </div>
                    <div class="col-xs-4">
                        <input type='checkbox' name='fltProvince' value='Fujian' checked>Fujian<br>
                        <input type='checkbox' name='fltProvince' value='Guangxi' checked>Guangxi<br>
                        <input type='checkbox' name='fltProvince' value='Heilongjiang' checked>Heilongjiang<br>
                        <input type='checkbox' name='fltProvince' value='Hunan' checked>Hubei<br>
                        <input type='checkbox' name='fltProvince' value='Jiangxi' checked>Jiangxi<br>
                        <input type='checkbox' name='fltProvince' value='Ningxia' checked>Ningxia<br>
                        <input type='checkbox' name='fltProvince' value='Shanxi' checked>Shanxi<br>
                        <input type='checkbox' name='fltProvince' value='Hainan' checked>Hainan<br>
                        <input type='checkbox' name='fltProvince' value='Yunnan' checked>Yunnan
                        <button id="btnProvinceFilterNone" class="btn btn-primary btn-block">Uncheck All</button>
                    </div>
                    <div class="col-xs-4">
                        <input type='checkbox' name='fltProvince' value='Gansu' checked>Gansu<br>
                        <input type='checkbox' name='fltProvince' value='Henan' checked>Henan<br>
                        <input type='checkbox' name='fltProvince' value='Inner_Mongolia' checked>Inner Mongolia<br>
                        <input type='checkbox' name='fltProvince' value='Jilin' checked>Jilin<br>
                        <input type='checkbox' name='fltProvince' value='Qinghai' checked>Qinghai<br>
                        <input type='checkbox' name='fltProvince' value='Shaanxi' checked>Shaanxi<br>
                        <input type='checkbox' name='fltProvince' value='Tibet' checked>Tibet<br>
                        <input type='checkbox' name='fltProvince' value='Zhejiang' checked>Zhejiang<br>
                        <input type='checkbox' name='fltProvince' value='Guizhou' checked>Guizhou
                        <button id="btnProvinceFilter" class="btn btn-primary btn-block">Refresh</button>
                    </div>
                </div>
                
                <div class="" id="divBUOWLData"></div>
            </div>
            <div id="divEagle" class="col-xs-12">
                <div id="divEagleLabel" class="text-center col-xs-12">
                    <h4 id="lblEagle">Metallogenic Province</h4>
                </div>
                <div id="divEagleError" class="errorMsg col-xs-12"></div>
                <div id="divFindEagle" class="form-group has-error">
                    <div class="col-xs-6">
                        <input type="text" id="txtFindEagle" class="form-control" placeholder="Metallogenic Province">
                    </div>
                    <div class="col-xs-6">
                        <button id="btnFindEagle" class="btn btn-primary btn-block">Find Metallogenic Province</button>
                    </div>
                </div>
                <div class="" id="divEagleData"></div>
            </div>
            <div id="divRaptor" class="col-xs-12">
                <div id="divRaptorLabel" class="text-center col-xs-12">
                    <h4 id="lblRaptor">Metal Type</h4>
                </div>
                <div id="divRaptorError" class="errorMsg col-xs-12"></div>
                <div id="divFindRaptor" class="form-group has-error">
                    <div class="col-xs-6">
                        <input type="text" id="txtFindRaptor" class="form-control" placeholder="Metal Type">
                    </div>
                    <div class="col-xs-6">
                        <button id="btnFindRaptor" class="btn btn-primary btn-block">Find Metal Type</button>
                    </div>
                </div>
                <div class="" id="divRaptorData"></div>
            </div>
            <div id="divSpecimen" class="col-xs-12">
                <div id="divSpecimenLabel" class="text-center col-xs-12">
                    <h4 id="lblSpecimen">Specimen</h4>
                </div>
                <div id="divSpecimenError" class="errorMsg col-xs-12"></div>
                <div id="divFindSpecimen" class="form-group has-error">
                    <div class="col-xs-6">
                        <input type="text" id="txtFindSpecimen" class="form-control" placeholder="Specimen">
                    </div>
                    <div class="col-xs-6">
                        <button id="btnFindSpecimen" class="btn btn-primary btn-block" >Find Specimen</button>
                    </div>
                </div>
                <div id="divFilterSpecimen" class="col-xs-12">
                    <div class="col-xs-4">
                        <input type='radio' name='fltSpecimen' value='ALL' checked>All
                    </div>
                    <div class="col-xs-4">
                        <input type='radio' name='fltSpecimen' value='galena'>Galena
                    </div>
                    <div class="col-xs-4">
                        <input type='radio' name='fltSpecimen' value='feldspar'>feldspar
                    </div>
                </div>
                <div class="" id="divSpecimenData"></div>
            </div>
        </div>
        <div id="mapdiv" class="col-md-12"></div>
  
       <script>
            var mymap;
            var lyrOSM;
            var lyrTopo;  /*add maps*/
            var lyrImagery;
            var lyrChinaPb;
            var lyrProvince;
            var lyrEagleNests; 
            var lyrRaptorNests; 
            var lyrMarkerCluster;  /*create marker clusters*/
            var lyrClientLines; /*add polyline*/
            var lyrSearch;
            var lyrBUOWL;/*add multi polygen/
            var lyrGBH;/*add multi polygen/ 
            var mrkCurrentLocation;
            var fgpDrawnItems; /*create feature group for drawn items*/
            var ctlLayers; /*add layers to include all maps*/
            var ctlDraw; /*able to draw your own data*/
            var objBasemaps; /*create base map selection for the layer*/
            var objOverlays; /*overlapping base maps*/
            var ctlStyle;
            var ctlAttribute;
            var ctlScale; 
            var ctlPan; 
            var ctlMouseposition;
            var ctlMeasure;
            var ctlEasybutton;
            var ctlSidebar;
            var arProjectIDs =[]; /*declare as empty array*/
            var arSpecimenIDs = [];
            var arProvinceIDs = [];
            
            $(document).ready(function(){  //put all variables in jquerry function
                
                // ********** Map Initialisation*******************************
                
                mymap = L.map('mapdiv', {center:[35.8, 104.15], zoom:5,
                attributionControl:false });
                
                ctlAttribute= L.control.attribution({position:"bottomleft",prefix:false}).addTo(mymap);
                ctlAttribute.addAttribution("OSM");
                ctlAttribute.addAttribution('&copy; <a href="http://millermountain.com">Miller Mountain LLC</a>')
                
                ctlScale=L.control.scale({position:"bottomleft",metric:false,maxWidth:200}).addTo(mymap);
                
                ctlPan= L.control.pan().addTo(mymap); // use pan tool for leaflet plugins 
                
                ctlMeasure = L.control.polylineMeasure().addTo(mymap); //use measure tool from leaflet plugins
            
                ctlEasybutton=L.easyButton('glyphicon-transfer',function(){
                   ctlSidebar.toggle(); 
                }).addTo(mymap);  // use easy button leaflet plugins and click to show sidebar 
                
                ctlSidebar=L.control.sidebar("side-bar").addTo(mymap); // use sidebar leaflet plugin, and pass side-bar we created before
                
                ctlMouseposition=L.control.mousePosition().addTo(mymap);// use mousepostion tool from leaflet plugins
                                
                
                // *****************Layer Initialisation***********************
                
                lyrTopo = L.tileLayer('https://{s}.tile.jawg.io/jawg-terrain/{z}/{x}/{y}{r}.png?access-token={accessToken}', {
                attribution: '<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                minZoom: 0,
                maxZoom: 22,
                subdomains: 'abcd',
                accessToken: 'SaHs091yc5t3FNhyNuGpzxqf4wPV8Vm8F2Sd2lF3om52lSlWjs9s2rhX9VlR0AC2'});
                lyrOSM = L.tileLayer.provider ('OpenStreetMap.Mapnik');
                lyrImagery = L.tileLayer.provider ('Esri.WorldImagery');
                mymap.addLayer(lyrTopo);
                
                fgpDrawnItems= new L.featureGroup();
                fgpDrawnItems.addTo(mymap);
                
                lyrMarkerCluster = L.markerClusterGroup();  // cluster points together
                
                lyrChinaPb =L.geoJSON.ajax('data/Chinalead.geojson',{pointToLayer:returnChinaPb,filter:filterSpecimen,filter:filterProvince});
                lyrChinaPb.on('data:loaded',function(){
                    arSpecimenIDs.sort(function(a,b){return a-b});
                    $("#txtFindSpecimen").autocomplete({
                        source:arSpecimenIDs
                    });
                   lyrMarkerCluster.clearLayers();
                   lyrMarkerCluster.addLayer(lyrChinaPb);
                   lyrMarkerCluster.addTo(mymap);
                });
                
                
                
                //****************Setup Layer Control*********************
                
                objBasemaps = {
                    "Topo Map": lyrTopo,
                    "Open Street Maps": lyrOSM,
                    "Imagery": lyrImagery,
                };
                
                objOverlays= {
                    "China Lead":lyrChinaPb,
                    "Drawn Items":fgpDrawnItems
                }; // overlay image and buttons need to declare layer before put in overlap
                
                ctlLayers=L.control.layers(objBasemaps,objOverlays).addTo(mymap);   // create a layer with all base maps. 
                ctlStyle = L.control.styleEditor({position:"topright"}).addTo(mymap);
                
                // *************Setup Draw Control**********************
                
                ctlDraw= new L.Control.Draw({
                    draw:{
                        circle:false
                    },
                    edit:{
                        featureGroup:fgpDrawnItems
                    }
                });
                ctlDraw.addTo(mymap); // add tool bar for drawing data
                
                mymap.on("draw:created", function(e){
                    console.log(e);
                    fgpDrawnItems.addLayer(e.layer);
                }); // make new features to be drawn on map
                
                //****************Location Event**********************
                
                mymap.on("locationfound",function(e) {
                         console.log(e);
                         if (mrkCurrentLocation) {
                             mrkCurrentLocation.remove();   // if it finds my location, remove that location if not carry on the next line
                         }
                         mrkCurrentLocation = L.circle(e.latlng,
                        {radius:e.accuracy/2}).addTo(mymap);   // add radis to circle based on how accurate the location is 
                         mymap.setView(e.latlng, 14);
                });
                
                mymap.on("locationerror",function(e) {
                    console.log(e);
                    alert("Location was not found");
                });
            });  
           
           
            //************** JQuery Event Handler******************   
           
            $("#btnLocate").click(function(){
                mymap.locate();
            });
                         
            //************** Specimen Funcations************************** 
             function returnSpecimenMarker(json, latlng){
                var att = json.properties;
                if (att.Specimen=='galena') {
                    var clrSpecimen = 'deeppink';
                } else {
                    var clrSpecimen = 'chartreuse';
                }
                arSpecimenIDs.push(att.Specimen.toString());
                return L.circle(latlng, {radius:804, color:clrSpecimen,fillColor:'chartreuse', fillOpacity:0.5}).bindTooltip("<h4>Eagle Nest: "+att.Specimen+"</h4>Status: "+att.Specimen);
            }
            
           
              function filterSpecimen(json) {
                var att=json.properties;
                var optFilter = $("input[name=fltSpecimen]:checked").val();
                if (optFilter=='ALL') {
                    return true;
                } else {
                    return (att.Specimen==optFilter);
                }
            }
           
               $("#btnFindSpecimen").click(function(){
                var val = $("#txtFindSpecimen").val();
                var lyr = returnLayerByAttribute(lyrChinaPb,'Specimen',val);
                if (lyr) {
                    if (lyrSearch) {
                        lyrSearch.remove();
                    }
                    lyrSearch = L.circle(lyr.getLatLng(), {radius:800, color:'red', weight:10, opacity:0.5, fillOpacity:0}).addTo(mymap);
                    mymap.setView(lyr.getLatLng(), 14);
                    var att = lyr.feature.properties;
                    $("#divSpecimenData").html("<h4 class='text-center'>Attributes</h4><h5>Status: "+att.Specimen+"</h5>");
                    $("#divSpecimenError").html("");
                } else {
                    $("#divSpecimenError").html("**** Eagle Nest ID not found ****");
                }
            });
            
            $("#lblSpecimen").click(function(){
                $("#divSpecimenData").toggle(); 
            });
            $("input[name=fltSpecimen]").click(function(){
                arSpecimenIDs=[];
                lyrChinaPb.refresh();
            });
           
           //************** Province functions************************** 
             function filterProvince(json) {
                var arProvinceFilter=[];
                $("input[name=fltProvince]").each(function(){
                    if (this.checked) {
                        arProvinceFilter.push(this.value);
                    }
                });
                var att = json.properties;
                switch (att.Province) {
                    case "Anhui":
                        return (arProvinceFilter.indexOf('Anhui')>=0);
                        break;
                    case "Fujian":
                        return (arProvinceFilter.indexOf('Fujian')>=0);
                        break;
                    case "Gansu":
                        return (arProvinceFilter.indexOf('Gansu')>=0);
                        break;
                    case "Guangdong":
                        return (arProvinceFilter.indexOf('Guangdong')>=0);
                        break;
                    case "Guangxi":
                        return (arProvinceFilter.indexOf('Guangxi')>=0);
                        break;
                    case "Guizhou":
                        return (arProvinceFilter.indexOf('Guizhou')>=0);
                        break;
                    case "Hebei":
                        return (arProvinceFilter.indexOf('Hebei')>=0);
                        break;
                    case "Heilongjiang":
                        return (arProvinceFilter.indexOf('Heilongjiang')>=0);
                        break;
                    case "Henan":
                        return (arProvinceFilter.indexOf('Henan')>=0);
                        break;
                     case "Hubei":
                        return (arProvinceFilter.indexOf('Hubei')>=0);
                        break;
                    case "Hunan":
                        return (arProvinceFilter.indexOf('Hunan')>=0);
                        break;
                    case "Inner_Mongolia":
                        return (arProvinceFilter.indexOf('Inner_Mongolia')>=0);
                        break;
                     case "Jiangsu":
                        return (arProvinceFilter.indexOf('Jiangsu')>=0);
                        break;
                    case "Jiangxi":
                        return (arProvinceFilter.indexOf('Jiangxi')>=0);
                        break;
                    case "Jilin":
                        return (arProvinceFilter.indexOf('Jilin')>=0);
                        break;
                     case "Liaoning":
                        return (arProvinceFilter.indexOf('Liaoning')>=0);
                        break;
                    case "Ningxia":
                        return (arProvinceFilter.indexOf('Ningxia')>=0);
                        break;
                    case "Qinghai":
                        return (arProvinceFilter.indexOf('Qinghai')>=0);
                        break;
                     case "Shandong":
                        return (arProvinceFilter.indexOf('Shandong')>=0);
                        break;
                    case "Shanxi":
                        return (arProvinceFilter.indexOf('Shanxi')>=0);
                        break;
                    case "Shaanxi":
                        return (arProvinceFilter.indexOf('Shaanxi')>=0);
                        break;
                     case "Sichuan":
                        return (arProvinceFilter.indexOf('Sichuan')>=0);
                        break;
                    case "Hainan":
                        return (arProvinceFilter.indexOf('Hainan')>=0);
                        break;
                    case "Tibet":
                        return (arProvinceFilter.indexOf('Tibet')>=0);
                        break;
                    case "Xinjiang":
                        return (arProvinceFilter.indexOf('Xinjiang')>=0);
                        break;
                    case "Yunnan":
                        return (arProvinceFilter.indexOf('Yunnan')>=0);
                        break;
                    case "Zhejiang":
                        return (arProvinceFilter.indexOf('Zhejiang')>=0);
                        break;
//                    default:
//                        return (arProvinceFilter.indexOf('Anhui')>=0);
//                        break;
                }
            }
           
           
            $("#lblProvince").click(function(){
                $("#divProvinceData").toggle(); 
            });
            
            $("#btnProvinceFilterAll").click(function(){
                $("input[name=fltProvince]").prop('checked', true);
            });
            
            $("#btnProvinceFilterNone").click(function(){
                $("input[name=fltProvince]").prop('checked', false);
            });
            
            $("#btnProvinceFilter").click(function(){
                arProvinceIDs=[]; 
                lyrChinaPb.refresh();
            });
           
         //************** General Funcations**************************                         
                                    
                                    
            function LatLngToArrayString(ll) {
                return "["+ll.lat.toFixed(5)+", "+ll.lng.toFixed(5)+"]";
            }
           
            function returnLayerByAttribute(lyr,att,val) {
                var arLayers = lyr.getLayers();
                for (i=0;i<arLayers.length-1;i++) {
                    var ftrVal = arLayers[i].feature.properties[att];
                    if (ftrVal==val) {
                        return arLayers[i];
                    }
                }
                return false;
            }
            
            function testLayerAttribute(ar, val, att, fg, err, btn) {
                if (ar.indexOf(val)<0) {
                    $(fg).addClass("has-error");
                    $(err).html("**** "+att+" NOT FOUND ****");
                    $(btn).attr("disabled", true);
                } else {
                    $(fg).removeClass("has-error");
                    $(err).html("");
                    $(btn).attr("disabled", false);
                }
            }
            
            function returnChinaPb(json,latlng){
                var att = json.properties;
//                var customPopup ="<h4 class = 'text-center'>Site: "+att.Site_En+"</h4><h5>Province: "+att.Province+"</h5><h5>Metallogenic Province: "+att.Metal_Province+"</h5><h5>Specimen: "+att.Specimen+"</h5><h5>Metal: "+att.Metal+"</h5><h5>206Pb/204Pb: "+att.Isotope_1+"</h5><h5>207Pb/204Pb: "+att.Isotope_2+"</h5><h5>208Pb/204Pb: "+att.Isotope_3+"</h5><h5>Model Age (Ma): "+att.Age+"</h5><h5>Mu: "+att.Mu+"</h5><h5>Kappa: "+att.Kappa+"</h5><h5>Year of Publication: "+att.Year+"</h5>";
                var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Site</th><td>"+att.Site_En+"</td></tr>" + "<tr><th>Province</th><td>"+att.Province+"</td></tr>" +  
                  "<tr><th>Metallogenic Province</th><td>"+att.Metal_Province+"</td></tr>" +
                  "<tr><th>Specimen</th><td>"+att.Specimen+"</td></tr>" +
                  "<tr><th>Metal</th><td>"+att.Metal+ "</td></tr>" +
                  "<tr><th>206Pb/204Pb</th><td>"+att.Isotope_1+"</td></tr>" +
                  "<tr><th>207Pb/204Pb</th><td>"+att.Isotope_2+"</td></tr>" +
                  "<tr><th>208Pb/204Pb</th><td>"+att.Isotope_3+"</td></tr>"  +
                  "<tr><th>Model Age (Ma)</th><td>"+att.Age+"</td></tr>" +
                  "<tr><th>Mu</th><td>"+att.Mu+"</td></tr>" +
                  "<tr><th>Kappa</th><td>"+att.Kappa+"</td></tr>"
                  "</table>";
                return L.circle(latlng, {radius:2500, color:"blue",fillColor:"blue",fillOpacity:0.3}).bindTooltip(content);
            }
       </script>
    </body>
</html>